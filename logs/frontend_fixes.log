======================================================================
ğŸ¯ FINAL FRONTEND SCHEMA FIXES
======================================================================

This script will fix frontend-database compatibility issues
by running three SQL migration files:
1. fix_missing_phase2_tables.sql - Creates missing Phase 2 tables
2. fix_frontend_schema_compatibility.sql - Fixes column name mismatches
3. fix_dram_table_structure.sql - Fixes DRAM table for frontend

Expected results:
â€¢ Carbon Credits page: No 'relationship' errors
â€¢ Verra Registration: Shows data
â€¢ DRAM page: Loads properly
â€¢ Financial Dashboard: All tables visible
======================================================================

ğŸ”— Establishing database connection...
âœ… Project reference: saelrsljpneclsbfdxfy
âœ… Using password: ***************
âœ… Connected to db.saelrsljpneclsbfdxfy.supabase.co
âœ… Database: PostgreSQL 17.6 on aarch64-unknown-linux-gnu
âœ… Public tables before: 19

======================================================================
ğŸš€ EXECUTING SQL FIXES
======================================================================

ğŸ“„ Executing: fix_missing_phase2_tables.sql
------------------------------------------------------------
   File size: 13,208 bytes
   ğŸ’¬ -- FIX MISSING PHASE 2 TABLES AND RELATIONSHIPS
   ğŸ’¬ -- Fixes console errors for:
   ğŸ’¬ -- 1. CREATE MISSING TABLES
   Found 79 SQL statements
   ğŸ“ Statement 1: BEGIN;
   âœ… Statement 1 executed
   ğŸ“ Statement 2: CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
   âœ… Statement 2 executed
   ğŸ“ Statement 3: CREATE TABLE IF NOT EXISTS verra_project_registrations (     id UUID DEFAULT uuid_generate_v4() PRIM...
   âœ… Statement 3 executed
   ğŸ“ Statement 4: CREATE TABLE IF NOT EXISTS price_list (     id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,     item...
   âœ… Statement 4 executed
   ğŸ“ Statement 5: CREATE TABLE IF NOT EXISTS financial_reports (     id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,  ...
   âœ… Statement 5 executed
   ğŸ“ Statement 6: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE tab...
   âŒ Statement 6 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 7:         ALTER TABLE carbon_credits          ADD CONSTRAINT carbon_credits_verra_registration_id_fkey...
   âŒ Statement 7 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 8:     END IF;
   âŒ Statement 8 failed: syntax error at or near "IF"
   ğŸ“ Statement 9: END $$;
   âŒ Statement 9 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 10: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.table_constraints         ...
   âŒ Statement 10 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 11:     END IF;
   âŒ Statement 11 failed: syntax error at or near "IF"
   ğŸ“ Statement 12: END $$;
   âŒ Statement 12 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 13: DO $$ DECLARE     sample_project_id UUID;
   âŒ Statement 13 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 14:     sample_program_id UUID;
   âŒ Statement 14 failed: syntax error at or near "sample_program_id"
   ğŸ“ Statement 15:     sample_account_id UUID;
   âŒ Statement 15 failed: syntax error at or near "sample_account_id"
   ğŸ“ Statement 16:     sample_budget_id UUID;
   âŒ Statement 16 failed: syntax error at or near "sample_budget_id"
   ğŸ“ Statement 17:     sample_verra_reg_id UUID;
   âŒ Statement 17 failed: syntax error at or near "sample_verra_reg_id"
   ğŸ“ Statement 18: BEGIN     SELECT id INTO sample_project_id FROM carbon_projects LIMIT 1;
   âŒ Statement 18 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 19:     SELECT id INTO sample_program_id FROM programs LIMIT 1;
   âŒ Statement 19 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 20:     SELECT id INTO sample_account_id FROM financial_accounts LIMIT 1;
   âŒ Statement 20 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 21:     SELECT id INTO sample_budget_id FROM budgets LIMIT 1;
   âŒ Statement 21 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 22:     IF sample_project_id IS NOT NULL THEN         INSERT INTO verra_project_registrations (         ...
   âŒ Statement 22 failed: syntax error at or near "IF"
   ğŸ“ Statement 23:         RAISE NOTICE 'âœ… Added Verra registration for project: %', sample_project_id;
   âŒ Statement 23 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 24:     END IF;
   âŒ Statement 24 failed: syntax error at or near "IF"
   ğŸ“ Statement 25:     IF sample_project_id IS NOT NULL AND sample_verra_reg_id IS NOT NULL THEN         INSERT INTO ca...
   âŒ Statement 25 failed: syntax error at or near "IF"
   ğŸ“ Statement 26:         RAISE NOTICE 'âœ… Added 3 carbon credits with Verra registration';
   âŒ Statement 26 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 27:     END IF;
   âŒ Statement 27 failed: syntax error at or near "IF"
   ğŸ“ Statement 28:     INSERT INTO price_list (         item_code,         item_name,         item_description,        ...
   âŒ Statement 28 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 29:     RAISE NOTICE 'âœ… Added 3 price list items';
   âŒ Statement 29 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 30:     IF sample_account_id IS NOT NULL THEN         INSERT INTO financial_reports (             report...
   âŒ Statement 30 failed: syntax error at or near "IF"
   ğŸ“ Statement 31:         RAISE NOTICE 'âœ… Added 2 financial reports';
   âŒ Statement 31 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 32:     END IF;
   âŒ Statement 32 failed: syntax error at or near "IF"
   ğŸ“ Statement 33:     IF sample_budget_id IS NOT NULL AND sample_project_id IS NOT NULL THEN         INSERT INTO finan...
   âŒ Statement 33 failed: syntax error at or near "IF"
   ğŸ“ Statement 34:         RAISE NOTICE 'âœ… Added 3 financial transactions';
   âŒ Statement 34 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 35:     END IF;
   âŒ Statement 35 failed: syntax error at or near "IF"
   ğŸ“ Statement 36: END $$;
   âŒ Statement 36 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 37: ALTER TABLE IF EXISTS verra_project_registrations DISABLE ROW LEVEL SECURITY;
   âŒ Statement 37 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 38: ALTER TABLE IF EXISTS price_list DISABLE ROW LEVEL SECURITY;
   âŒ Statement 38 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 39: ALTER TABLE IF EXISTS financial_reports DISABLE ROW LEVEL SECURITY;
   âŒ Statement 39 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 40: ALTER TABLE IF EXISTS financial_transactions DISABLE ROW LEVEL SECURITY;
   âŒ Statement 40 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 41: ALTER TABLE IF EXISTS carbon_credits DISABLE ROW LEVEL SECURITY;
   âŒ Statement 41 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 42: GRANT USAGE ON SCHEMA public TO anon;
   âŒ Statement 42 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 43: GRANT SELECT ON ALL TABLES IN SCHEMA public TO anon;
   âŒ Statement 43 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 44: GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO anon;
   âŒ Statement 44 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 45: DO $$ DECLARE     verra_count INTEGER;
   âŒ Statement 45 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 46:     credits_count INTEGER;
   âŒ Statement 46 failed: syntax error at or near "credits_count"
   ğŸ“ Statement 47:     price_items_count INTEGER;
   âŒ Statement 47 failed: syntax error at or near "price_items_count"
   ğŸ“ Statement 48:     reports_count INTEGER;
   âŒ Statement 48 failed: syntax error at or near "reports_count"
   ğŸ“ Statement 49:     transactions_count INTEGER;
   âŒ Statement 49 failed: syntax error at or near "transactions_count"
   ğŸ“ Statement 50: BEGIN     SELECT COUNT(*) INTO verra_count FROM verra_project_registrations;
   âŒ Statement 50 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 51:     SELECT COUNT(*) INTO credits_count FROM carbon_credits;
   âŒ Statement 51 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 52:     SELECT COUNT(*) INTO price_items_count FROM price_list;
   âŒ Statement 52 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 53:     SELECT COUNT(*) INTO reports_count FROM financial_reports;
   âŒ Statement 53 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 54:     SELECT COUNT(*) INTO transactions_count FROM financial_transactions;
   âŒ Statement 54 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 55:     RAISE NOTICE '=========================================';
   âŒ Statement 55 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 56:     RAISE NOTICE 'MISSING TABLES FIX COMPLETE';
   âŒ Statement 56 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 57:     RAISE NOTICE '=========================================';
   âŒ Statement 57 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 58:     RAISE NOTICE 'Tables created/updated:';
   âŒ Statement 58 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 59:     RAISE NOTICE '  â€¢ verra_project_registrations: % row(s)', verra_count;
   âŒ Statement 59 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 60:     RAISE NOTICE '  â€¢ carbon_credits: % row(s) (now with verra_registration_id)', credits_count;
   âŒ Statement 60 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 61:     RAISE NOTICE '  â€¢ price_list: % row(s)', price_items_count;
   âŒ Statement 61 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 62:     RAISE NOTICE '  â€¢ financial_reports: % row(s)', reports_count;
   âŒ Statement 62 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 63:     RAISE NOTICE '  â€¢ financial_transactions: % row(s)', transactions_count;
   âŒ Statement 63 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 64:     RAISE NOTICE '';
   âŒ Statement 64 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 65:     RAISE NOTICE 'Frontend errors should now be fixed:';
   âŒ Statement 65 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 66:     RAISE NOTICE '  â€¢ Carbon Credits page: Relationship with verra_project_registrations âœ…';
   âŒ Statement 66 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 67:     RAISE NOTICE '  â€¢ Verra Registration page: Table exists with sample data âœ…';
   âŒ Statement 67 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 68:     RAISE NOTICE '  â€¢ Financial Dashboard: All tables have sample data âœ…';
   âŒ Statement 68 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 69:     RAISE NOTICE '  â€¢ No more "Error fetching financial data: {}" âœ…';
   âŒ Statement 69 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 70:     RAISE NOTICE '  â€¢ No more "Could not find relationship" error âœ…';
   âŒ Statement 70 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 71:     RAISE NOTICE '';
   âŒ Statement 71 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 72:     RAISE NOTICE 'Test with frontend:';
   âŒ Statement 72 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 73:     RAISE NOTICE '  1. Carbon Credits page should show 3 credits';
   âŒ Statement 73 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 74:     RAISE NOTICE '  2. Verra Registration page should show 1 registration';
   âŒ Statement 74 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 75:     RAISE NOTICE '  3. Financial Dashboard should show data';
   âŒ Statement 75 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 76:     RAISE NOTICE '=========================================';
   âŒ Statement 76 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 77: END $$;
   âŒ Statement 77 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 78: SELECT 'ğŸ‰ Missing Phase 2 tables and relationships fixed! All frontend errors should be resolved.' A...
   âŒ Statement 78 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 79: COMMIT;
   âœ… Statement 79 executed

   ğŸ“Š Results: 6 successful, 73 failed
   âš ï¸  Some statements had errors (but script continues)

----------------------------------------------------------------------

ğŸ“„ Executing: fix_frontend_schema_compatibility.sql
------------------------------------------------------------
   File size: 6,548 bytes
   ğŸ’¬ -- FIX FRONTEND SCHEMA COMPATIBILITY
   ğŸ’¬ -- 1. FIX VERRA_PROJECT_REGISTRATIONS TABLE FOR FRONTEND COMPATIBILITY
   ğŸ’¬ -- 2. FIX CARBON_CREDITS TABLE FOR FRONTEND COMPATIBILITY
   Found 43 SQL statements
   ğŸ“ Statement 1: BEGIN;
   âœ… Statement 1 executed
   ğŸ“ Statement 2: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE tab...
   âŒ Statement 2 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 3:     END IF;
   âŒ Statement 3 failed: syntax error at or near "IF"
   ğŸ“ Statement 4:     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE table_schema = '...
   âŒ Statement 4 failed: syntax error at or near "IF"
   ğŸ“ Statement 5:     END IF;
   âŒ Statement 5 failed: syntax error at or near "IF"
   ğŸ“ Statement 6: END $$;
   âŒ Statement 6 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 7: UPDATE verra_project_registrations  SET      verra_project_id = registration_code,     carbon_projec...
   âŒ Statement 7 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 8: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE tab...
   âŒ Statement 8 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 9:     END IF;
   âŒ Statement 9 failed: syntax error at or near "IF"
   ğŸ“ Statement 10: END $$;
   âŒ Statement 10 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 11: UPDATE carbon_credits  SET issuance_date = issue_date  WHERE issuance_date IS NULL AND issue_date IS...
   âŒ Statement 11 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 12: UPDATE carbon_projects  SET      kode_project = project_code,     nama_project = project_name WHERE ...
   âŒ Statement 12 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 13: DO $$ DECLARE     sample_verra_id UUID;
   âŒ Statement 13 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 14:     sample_project_id UUID;
   âŒ Statement 14 failed: syntax error at or near "sample_project_id"
   ğŸ“ Statement 15: BEGIN     SELECT id INTO sample_verra_id FROM verra_project_registrations LIMIT 1;
   âŒ Statement 15 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 16:     SELECT id INTO sample_project_id FROM carbon_projects LIMIT 1;
   âŒ Statement 16 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 17:     IF sample_verra_id IS NOT NULL THEN         INSERT INTO carbon_credits (             project_id,...
   âŒ Statement 17 failed: syntax error at or near "IF"
   ğŸ“ Statement 18:         RAISE NOTICE 'âœ… Added 2 more carbon credits for testing';
   âŒ Statement 18 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 19:     END IF;
   âŒ Statement 19 failed: syntax error at or near "IF"
   ğŸ“ Statement 20: END $$;
   âŒ Statement 20 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 21: DO $$ DECLARE     verra_with_carbon_project_id INTEGER;
   âŒ Statement 21 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 22:     credits_with_issuance_date INTEGER;
   âŒ Statement 22 failed: syntax error at or near "credits_with_issuance_date"
   ğŸ“ Statement 23:     total_credits INTEGER;
   âŒ Statement 23 failed: syntax error at or near "total_credits"
   ğŸ“ Statement 24: BEGIN     SELECT COUNT(*) INTO verra_with_carbon_project_id      FROM verra_project_registrations   ...
   âŒ Statement 24 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 25:     SELECT COUNT(*) INTO credits_with_issuance_date      FROM carbon_credits      WHERE issuance_dat...
   âŒ Statement 25 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 26:     SELECT COUNT(*) INTO total_credits FROM carbon_credits;
   âŒ Statement 26 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 27:     RAISE NOTICE '=========================================';
   âŒ Statement 27 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 28:     RAISE NOTICE 'FRONTEND SCHEMA COMPATIBILITY FIX';
   âŒ Statement 28 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 29:     RAISE NOTICE '=========================================';
   âŒ Statement 29 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 30:     RAISE NOTICE 'Schema updates:';
   âŒ Statement 30 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 31:     RAISE NOTICE '  â€¢ verra_project_registrations with carbon_project_id: %/%',          verra_with_...
   âŒ Statement 31 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 32:     RAISE NOTICE '  â€¢ carbon_credits with issuance_date: %/%',          credits_with_issuance_date, ...
   âŒ Statement 32 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 33:     RAISE NOTICE '';
   âŒ Statement 33 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 34:     RAISE NOTICE 'Frontend queries should now work:';
   âŒ Statement 34 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 35:     RAISE NOTICE '  â€¢ Carbon Credits page: Has issuance_date column âœ…';
   âŒ Statement 35 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 36:     RAISE NOTICE '  â€¢ Verra Registration: Has verra_project_id & carbon_project_id âœ…';
   âŒ Statement 36 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 37:     RAISE NOTICE '  â€¢ No more "Could not find relationship" error âœ…';
   âŒ Statement 37 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 38:     RAISE NOTICE '';
   âŒ Statement 38 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 39:     RAISE NOTICE 'Testing frontend query compatibility...';
   âŒ Statement 39 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 40: END $$;
   âŒ Statement 40 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 41: SELECT      'âœ… Frontend compatibility test:' as test,     cc.id as credit_id,     cc.serial_number, ...
   âŒ Statement 41 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 42: SELECT 'ğŸ‰ Frontend schema compatibility fixed! Carbon Credits and Verra Registration pages should wo...
   âŒ Statement 42 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 43: COMMIT;
   âœ… Statement 43 executed

   ğŸ“Š Results: 2 successful, 41 failed
   âš ï¸  Some statements had errors (but script continues)

----------------------------------------------------------------------

ğŸ“„ Executing: fix_dram_table_structure.sql
------------------------------------------------------------
   File size: 7,877 bytes
   ğŸ’¬ -- FIX DRAM TABLE STRUCTURE TO MATCH FRONTEND EXPECTATIONS
   ğŸ’¬ -- Frontend is querying table 'dram' (singular) but we created 'dram_documents' (plural)
   ğŸ’¬ -- 1. CREATE DRAM TABLE (SINGULAR) WITH FRONTEND-EXPECTED STRUCTURE
   ğŸ’¬ -- Create a dummy program if none exists
   Found 53 SQL statements
   ğŸ“ Statement 1: BEGIN;
   âœ… Statement 1 executed
   ğŸ“ Statement 2: CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
   âœ… Statement 2 executed
   ğŸ“ Statement 3: CREATE TABLE IF NOT EXISTS dram (     id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,     program_id...
   âœ… Statement 3 executed
   ğŸ“ Statement 4: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE tab...
   âŒ Statement 4 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 5:     END IF;
   âŒ Statement 5 failed: syntax error at or near "IF"
   ğŸ“ Statement 6:     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE table_schema = '...
   âŒ Statement 6 failed: syntax error at or near "IF"
   ğŸ“ Statement 7:     END IF;
   âŒ Statement 7 failed: syntax error at or near "IF"
   ğŸ“ Statement 8: END $$;
   âŒ Statement 8 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 9: DO $$  BEGIN     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE tab...
   âŒ Statement 9 failed: unterminated dollar-quoted string at or near "$$ 
   ğŸ“ Statement 10:     END IF;
   âŒ Statement 10 failed: syntax error at or near "IF"
   ğŸ“ Statement 11:     IF NOT EXISTS (         SELECT 1 FROM information_schema.columns          WHERE table_schema = '...
   âŒ Statement 11 failed: syntax error at or near "IF"
   ğŸ“ Statement 12:     END IF;
   âŒ Statement 12 failed: syntax error at or near "IF"
   ğŸ“ Statement 13: END $$;
   âŒ Statement 13 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 14: UPDATE programs  SET      kode_program = program_code,     nama_program = program_name WHERE (kode_p...
   âŒ Statement 14 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 15: UPDATE carbon_projects  SET      kode_project = project_code,     nama_project = project_name WHERE ...
   âŒ Statement 15 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 16: DO $$ DECLARE     sample_program_id UUID;
   âŒ Statement 16 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 17:     sample_project_id UUID;
   âŒ Statement 17 failed: syntax error at or near "sample_project_id"
   ğŸ“ Statement 18: BEGIN     SELECT id INTO sample_program_id FROM programs LIMIT 1;
   âŒ Statement 18 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 19:     SELECT id INTO sample_project_id FROM carbon_projects LIMIT 1;
   âŒ Statement 19 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 20:     IF sample_program_id IS NOT NULL THEN         INSERT INTO dram (             program_id,        ...
   âŒ Statement 20 failed: syntax error at or near "IF"
   ğŸ“ Statement 21:         INSERT INTO dram (             program_id,             versi,             tujuan_mitigasi,  ...
   âŒ Statement 21 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 22:         RAISE NOTICE 'âœ… Added sample DRAM data for program ID: %', sample_program_id;
   âŒ Statement 22 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 23:     ELSE         INSERT INTO programs (             program_code,             program_name,         ...
   âŒ Statement 23 failed: syntax error at or near "ELSE"
   ğŸ“ Statement 24:         RAISE NOTICE 'âš ï¸ Created dummy program for DRAM testing';
   âŒ Statement 24 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 25:     END IF;
   âŒ Statement 25 failed: syntax error at or near "IF"
   ğŸ“ Statement 26: END $$;
   âŒ Statement 26 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 27: ALTER TABLE IF EXISTS dram DISABLE ROW LEVEL SECURITY;
   âŒ Statement 27 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 28: GRANT USAGE ON SCHEMA public TO anon;
   âŒ Statement 28 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 29: GRANT SELECT ON ALL TABLES IN SCHEMA public TO anon;
   âŒ Statement 29 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 30: GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO anon;
   âŒ Statement 30 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 31: DO $$ DECLARE     dram_count INTEGER;
   âŒ Statement 31 failed: unterminated dollar-quoted string at or near "$$
   ğŸ“ Statement 32:     programs_with_kode INTEGER;
   âŒ Statement 32 failed: syntax error at or near "programs_with_kode"
   ğŸ“ Statement 33:     projects_with_kode INTEGER;
   âŒ Statement 33 failed: syntax error at or near "projects_with_kode"
   ğŸ“ Statement 34: BEGIN     SELECT COUNT(*) INTO dram_count FROM dram;
   âŒ Statement 34 failed: syntax error at or near "SELECT"
   ğŸ“ Statement 35:     SELECT COUNT(*) INTO programs_with_kode FROM programs WHERE kode_program IS NOT NULL;
   âŒ Statement 35 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 36:     SELECT COUNT(*) INTO projects_with_kode FROM carbon_projects WHERE kode_project IS NOT NULL;
   âŒ Statement 36 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 37:     RAISE NOTICE '=========================================';
   âŒ Statement 37 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 38:     RAISE NOTICE 'DRAM FRONTEND COMPATIBILITY FIX';
   âŒ Statement 38 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 39:     RAISE NOTICE '=========================================';
   âŒ Statement 39 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 40:     RAISE NOTICE 'Tables created/updated:';
   âŒ Statement 40 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 41:     RAISE NOTICE '  â€¢ dram: % row(s) (singular table for frontend)', dram_count;
   âŒ Statement 41 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 42:     RAISE NOTICE '  â€¢ programs with kode_program: %/%', programs_with_kode, (SELECT COUNT(*) FROM pr...
   âŒ Statement 42 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 43:     RAISE NOTICE '  â€¢ carbon_projects with kode_project: %/%', projects_with_kode, (SELECT COUNT(*) ...
   âŒ Statement 43 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 44:     RAISE NOTICE '';
   âŒ Statement 44 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 45:     RAISE NOTICE 'Frontend should now work with:';
   âŒ Statement 45 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 46:     RAISE NOTICE '  â€¢ DRAM page: Query to table "dram" (singular)';
   âŒ Statement 46 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 47:     RAISE NOTICE '  â€¢ Columns: versi, tujuan_mitigasi, timeline_start, timeline_end, anggaran_total'...
   âŒ Statement 47 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 48:     RAISE NOTICE '  â€¢ Status: draft, active (for status badges)';
   âŒ Statement 48 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 49:     RAISE NOTICE '  â€¢ No more "Error fetching DRAM: {}" error';
   âŒ Statement 49 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 50:     RAISE NOTICE '=========================================';
   âŒ Statement 50 failed: syntax error at or near "RAISE"
   ğŸ“ Statement 51: END $$;
   âŒ Statement 51 failed: unterminated dollar-quoted string at or near "$$;"
   ğŸ“ Statement 52: SELECT 'âœ… DRAM table structure fixed! Frontend DRAM page should now work without errors.' AS status;
   âŒ Statement 52 failed: current transaction is aborted, commands ignored until end of transaction block
   ğŸ“ Statement 53: COMMIT;
   âœ… Statement 53 executed

   ğŸ“Š Results: 4 successful, 49 failed
   âš ï¸  Some statements had errors (but script continues)

----------------------------------------------------------------------

============================================================
ğŸ” VERIFICATION
============================================================

ğŸ“Š Checking Phase 2 tables...
âœ… Phase 2 tables created:
   â€¢ carbon_credits
   â€¢ dram
   â€¢ financial_reports
   â€¢ price_list
   â€¢ verra_project_registrations

ğŸ“Š Checking carbon_credits compatibility...
âœ… Compatibility columns in carbon_credits:
   â€¢ issuance_date
   â€¢ verra_registration_id

ğŸ“Š Checking DRAM table...
âœ… DRAM table has 2 records
âœ… DRAM has 5 frontend-compatible columns

ğŸ“Š Checking relationships...
âœ… Foreign key relationships:
   â€¢ carbon_credits.project_id â†’ carbon_projects.id
   â€¢ carbon_credits.verra_registration_id â†’ verra_project_registrations.id
   â€¢ verra_project_registrations.project_id â†’ carbon_projects.id

======================================================================
âš ï¸  SOME FIXES HAD ERRORS (check output above)

ğŸ¯ FRONTEND BENEFITS:
â€¢ 'Could not find relationship' errors should be fixed
â€¢ 'Error fetching data: {}' errors should be resolved
â€¢ All Phase 2 pages should work

ğŸ“‹ NEXT STEPS:
1. Restart the Next.js development server
2. Clear browser cache if needed
3. Test Carbon Credits, Verra Registration, and DRAM pages
4. Check Financial Dashboard

âœ… Script execution completed!
ğŸ”Œ Database connection closed
