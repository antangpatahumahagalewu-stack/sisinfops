ğŸš€ FIXING VVB-TO-VERRA RELATIONSHIP

This script will fix the missing relationship error:
âŒ 'Could not find a relationship between 'vvb_engagements' and 'verra_project_registrations' in the schema cache'
============================================================
============================================================
ğŸ” CHECKING TABLE RELATIONSHIPS
============================================================
âœ… Connected to db.saelrsljpneclsbfdxfy.supabase.co

ğŸ“Š vvb_engagements table columns:
   â€¢ id (uuid, nullable: NO)
   â€¢ project_id (uuid, nullable: YES)
   â€¢ vvb_id (uuid, nullable: YES)
   â€¢ engagement_type (character varying, nullable: YES)
   â€¢ engagement_status (character varying, nullable: YES)
   â€¢ start_date (date, nullable: YES)
   â€¢ end_date (date, nullable: YES)
   â€¢ contract_number (character varying, nullable: YES)
   â€¢ contract_value (numeric, nullable: YES)
   â€¢ currency (character varying, nullable: YES)
   â€¢ notes (text, nullable: YES)
   â€¢ created_at (timestamp with time zone, nullable: YES)
   â€¢ updated_at (timestamp with time zone, nullable: YES)

ğŸ”— Foreign key relationships:
   â€¢ vvb_engagements.project_id â†’ carbon_projects.id
   â€¢ vvb_engagements.vvb_id â†’ vvb_organizations.id

ğŸ“Š verra_project_registrations table columns:
   â€¢ project_id (uuid)
   â€¢ verra_project_id (character varying)
   â€¢ carbon_project_id (uuid)

ğŸ“Š carbon_projects table columns:
   â€¢ id (uuid)
   â€¢ ps_id (uuid)
   â€¢ project_code (character varying)
   â€¢ project_name (character varying)
   â€¢ project_type (character varying)
âœ… Carbon projects count: 3

ğŸ”Œ Database connection closed

============================================================
ğŸ”§ FIXING VVB-TO-VERRA RELATIONSHIP
============================================================

Problem: Frontend expects relationship between vvb_engagements and verra_project_registrations
Solution: Add verra_registration_id column to vvb_engagements
============================================================
âœ… Connected to db.saelrsljpneclsbfdxfy.supabase.co

ğŸ”¨ Adding verra_registration_id column...
âœ… Added verra_registration_id column

ğŸ”— Adding foreign key constraint...
âœ… Foreign key constraint already exists

ğŸ”— Linking existing data...
âœ… Linked 2 vvb_engagements to verra registrations

ğŸ” Verifying relationships...
âœ… Total vvb_engagements: 2
âœ… With verra_registration_id: 2
âœ… Without verra_registration_id: 0

ğŸ“‹ Sample linked data:
   â€¢ CON-2025-001: verification, Project: CP-001, Verra: VERRA-VCS-2025-001, Status: registered
   â€¢ CON-2024-001: validation, Project: CP-001, Verra: VERRA-VCS-2025-001, Status: registered

âœ… Relationship fixed successfully!
ğŸ”Œ Database connection closed

============================================================
ğŸ” TESTING FRONTEND QUERY
============================================================
âœ… Connected to db.saelrsljpneclsbfdxfy.supabase.co

ğŸ“Š Testing Supabase-style relationship query...
âœ… Relationship query successful! Found 2 results

ğŸ“‹ Result structure:
   â€¢ vvb_engagements columns: 14
   â€¢ verra_project_registrations columns: 17
   â€¢ First result has 45 columns total
   â€¢ Sample join: CON-2024-001 â†’ Verra: VERRA-VCS-2025-001, VVB: TÃœV Rheinland

============================================================
ğŸ‰ RELATIONSHIP FIX COMPLETED!
============================================================

âœ… Frontend VVB Management page should now work without relationship errors.

ğŸ“‹ NEXT STEPS:
1. Supabase needs to refresh its schema cache (usually automatic)
2. Restart Next.js server if still having issues
3. Clear browser cache
4. Test http://localhost:3001/dashboard/vvb-management
